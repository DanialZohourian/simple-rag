{% extends "base.html" %}
{% block content %}

<div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
  <section class="lg:col-span-2 glass rounded-2xl p-6 soft-border shadow-glow">
    <h2 class="text-lg font-semibold">History item #{{ item.id }}</h2>
    <div class="text-xs text-slate-500 mt-1">{{ item.created_at }}</div>

    <div class="mt-5">
      <div class="text-xs uppercase tracking-wide text-slate-500">Question</div>
      <div class="mt-2 text-sm text-slate-200 whitespace-pre-wrap">{{ item.question }}</div>
    </div>

    <div class="mt-6 flex gap-2">
      <a href="{{ url_for('history_page') }}"
         class="rounded-lg px-3 py-2 text-xs font-semibold soft-border glass hover:bg-slate-800/30 transition">
        Back
      </a>

      <form method="post" action="{{ url_for('delete_history', history_id=item.id) }}"
            onsubmit="return confirm('Delete this history item?');">
        <button class="rounded-lg px-3 py-2 text-xs font-semibold soft-border glass hover:bg-red-500/10 hover:border-red-500/30 transition">
          Delete
        </button>
      </form>
    </div>
  </section>

  <section class="lg:col-span-3 glass rounded-2xl p-6 soft-border">
    <h2 class="text-lg font-semibold">Answer</h2>

    <div class="mt-4 rounded-xl p-5 bg-slate-900/35 soft-border">
      <div class="prose prose-invert max-w-none prose-p:leading-relaxed">
        {{ item.answer | replace("\n", "<br/>") | safe }}
      </div>
    </div>

    <div class="mt-6 flex items-center justify-between">
      <h3 class="text-base font-semibold">Retrieved context</h3>
      <div class="text-xs text-slate-500">{{ item.sources|length }} chunk(s)</div>
    </div>

    <div class="mt-3 space-y-3">
      {% for s in item.sources %}
        <details class="rounded-xl bg-slate-900/30 soft-border overflow-hidden">
          <summary class="cursor-pointer px-4 py-3 flex items-center justify-between gap-4">
            <div class="min-w-0">
              <div class="text-sm font-semibold truncate">
                [{{ loop.index }}] {{ s.metadata.file_name }}
              </div>
              <div class="text-xs text-slate-400 mt-0.5">
                page: {{ s.metadata.page_number }} â€¢ chunk: {{ s.metadata.chunk_number }}
              </div>
            </div>
            <div class="text-xs text-slate-500">expand</div>
          </summary>
          <div class="px-4 pb-4 text-sm text-slate-200">
            <div class="mt-2 whitespace-pre-wrap">{{ s.document }}</div>
          </div>
        </details>
      {% endfor %}
    </div>
  </section>
</div>

{% endblock %}
